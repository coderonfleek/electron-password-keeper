<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Log In to WebVR Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
<h1>Welcome</h1>
<p>
  <button id="login">Click here to sign in.</button>
</p>

<script>
  const { ipcRenderer } = require('electron');

  ipcRenderer.send('loaded');

  ipcRenderer.on('globalProps', (event, props) => {
    const {audience, auth0Domain, clientId, clientSecret, customScheme, customDomain} = props;
    // TODO generate better (random?) nonce and state properties

    const nonce = 'XHcLb-0hZg~V5u~lz-KKpr8rfqlQh9JZ';
    const redirectUri = `${customScheme}://${customDomain}/home.html`;
    const responseType = 'code id_token';
    const scope = 'openid profile offline_access';
    const state = 'czc13QkjPlb9V-xCmMpqDlURjSyse02L';

    // checking for refresh token to redirect authenticated users
    const refresh_token = localStorage.getItem('refresh_token');
    if (refresh_token) window.location.assign(encodeURI(redirectUri));

    const authorisationUrl = 'https://' + auth0Domain + '/authorize' +
      '?client_id=' + clientId +
      '&client_secret=' + clientSecret +
      '&response_type=' + responseType +
      '&redirect_uri=' + redirectUri +
      '&scope=' + scope +
      '&audience=' + audience +
      '&state=' + state +
      '&nonce=' + nonce;

    function login() {
      window.location.assign(encodeURI(authorisationUrl));
    }

    document.getElementById('login').onclick = login;
  });
</script>
</body>
</html>
